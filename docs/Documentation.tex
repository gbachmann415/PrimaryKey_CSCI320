\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{listings}

\lstset{frame=tb,
  language=SQL,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=2
}
\title{Movie List}

\date{\today} 

\author{Primary Keys \\
aew1756: Ari Wisenburn\\
        txb9274: Milo Berry\\
        ggb6130: Gunnar Bachmann\\
        np7437: Noah Pelletier\\
        }

\begin{document}

\maketitle

\section{Introduction}
Our domain is the Movie Domain which will follow a very similar outline as the Music domain. Rather than users creating collections of music, it will be of movies instead. Users will be able to create collections of movies and search for movies based off of name, release date, cast members, studio, and genre. Users will also be able to sort movies, add and delete movies from their collection, rate movies, and even watch movies individually (or play an entire collection). Following and unfollowing friends will function the same as our primary domain.

Our program will be primarily written in Python and we will be using a PostgreSQL database. User interaction will be driven through a Python-based GUI.

\section{Design}
\subsection{Conceptual Model}
\includegraphics[scale=0.75]{ERDiagram.pdf} \\
Most of our ER Diagram is created directly from the requirements. \\\\
The biggest consideration made was the inclusion of the \emph{Genre} entity. This allows us to re-use genres between movies without re-creating on that already exists keeping our database in 3NF. \\\\
Another consideration of the table, was the inclusion of the \emph{Date Watched} attribute in the \emph{Watches} relationship. The requirements mention that in Phase 4, we need to be able to find the most popular movies in the past 90 days as well as allow users to mark every time they play a movie, we decided to include the date they marked the movie as watched to allow us to easily perform these queries as well as have multiple entries for the same movie from the same user. \\\\
\subsection{Reduction to tables}
\includegraphics[scale=0.75]{reduction to tables.pdf} \\
For the \emph{Person} entity, this comprises only of a \emph{Person Id} and a \emph{Name Id} for an individual with the \emph{Person Id} as the primary key and \emph{Name Id} as a foreign key to the \emph{Name} table. Looking at the relationships with the \emph{Person} entity, \emph{Acts In} became its own table since it is an N:M relationship while \emph{Directs} turned into the field \emph{Director Id} within the \emph{Movie} table since movies can only have a single director. The primary key for the \emph{ActsIn} table is a combination of the \emph{Movie Id} and \emph{Person Id} since these two elements will always be unique together.\\\\
Regarding the \emph{Name} table, since \emph{Name} is a composite attribute made up of \emph{First Name} and \emph{Last Name}, it was split off into its own table. \\\\
Moving forward to the \emph{Movie} entity itself, the \emph{Average User Rating} was disregarded in the table since it is a derived attribute and will be calculated when needed. \emph{Genre} has also been given its own entity type since multiple movies can have the same genre. The \emph{Classifies} relationship connects \emph{Genre} and \emph{Movie} with its primary key comprising of \emph{Genre Id} and \emph{Movie Id}. \\\\
Then looking at the \emph{Studio} entity, the entity itself was converted into a simple table with all its attributes. But the \emph{Funds} relationship between the \emph{Movie} entity and the \emph{Studio} entity was moved into its own separate table called \emph{Funds} since they have an N:M relationship. \\\\
Next looking at the \emph{User} entity, the entity was mapped to its own table with all its attributes except the composite \emph{Name} attribute. Since we already have a \emph{Name} table, the \emph{User} table gets the attribute \emph{Name Id} as a reference to this table. Then translating the relationship \emph{Watches} between the \emph{User} entity and the \emph{Movie} entity, this was moved into its own separate table named \emph{Watched} with the relationship attributes as well as foreign keys to the \emph{Movie Id}, \emph{Date Watched}, and \emph{Username} which make up the primary key of the table. The \emph{User} entity also has the relationship \emph{Follow} that was converted to the table \emph{Following} since the relationship is M:N and with the primary key comprised of the \emph{Collection Id} and \emph{Movie Id}\\\\
Lastly, discussing the \emph{Collection} entity, this was transformed into its own table with only the attributes \emph{Collection Id} and \emph{Name} since the other 2 attributes are derived attributes. This table also includes a foreign key \emph{Username} to reference the user that created it since collections can only be created by a single user. Then its relationship \emph{Comprises} was turned into its own table \emph{MoviesInCollection} since the relationship is N:M which has the \emph{Collection Id} and \emph{Movie Id} as its primary key.
\subsection{Data Requirements/Constraints}
Within the \emph{Person} entity, the \emph{Name} and \emph{Id} for each person is required and unique. There is also a foreign-key constraint on \emph{Name Id} which connects to the \emph{Name} entity.\\\\
For the \emph{Studio} entity, the \emph{Studio Id} is required and unique. The name is also required. The \emph{Funds} relationship has two foreign key constraints on \emph{Movie Id} for the \emph{Movie} entity and \emph{Studio Id} for the \emph{Studio} entity.\\\\
For the \emph{Movie} entity, the attribute \emph{Movie Id} is required and unique. The other required attributes are \emph{MPAA Rating}, \emph{Release Date}, \emph{Runtime}, and \emph{Genre}. The relationships \emph{Funds}. \emph{Acts In} and \emph{Directs} all have total participation meaning each \emph{Movie} entity must have at least one entry in these relationship tables. The \emph{MPAA Rating} must be one of the following: G, PG, PG-13, R, NR, or NC-17. There is also a foreign-key constraint for the \emph{Director Id} that connects to the \emph{Person} entity. The \emph{ActsIn} relationship has two foreign keys, \emph{Movie Id} and \emph{Person Id}, to connect it to the \emph{Movie} and \emph{Person} entities correspondingly.\\\\
For the \emph{Genre} entity, the attribute \emph{Genre Id} is required and unique. \emph{Name} is also required. The \emph{MovieGenre} relationship has 2 foreign key constraints: one for \emph{Movie Id} to relate it to the \emph{Movie} entity and one for the \emph{Genre Id} to relate it to the \emph{Genre} entity.\\\\
For the \emph{Watched} relationship, the \emph{Rating} attribute must be one of the following: 1, 2, 3, 4, or 5. There is a foreign key, \emph{Username}, to the \emph{User} entity and another, \emph{Movie Id}, to the \emph{Movie} entity. \\\\
For the \emph{Collection} entity, the \emph{Collection Id} is required and unique. \emph{Name} is also a required attribute. The reduction to table for this entity includes a required \emph{Username} attribute as well that is a foreign key constraint to the \emph{User} entity.The relationship \emph{MoviesInCollection} has two foreign key constraints to \emph{Collection} entity, \emph{Collection Id}, and the \emph{Movie} entity, \emph{Movie Id}. \\\\
Lastly, for the \emph{User} entity, the \emph{Username} and \emph{Email} attributes are required and unique. The \emph{Password}, \emph{Name}, \emph{Creation Date}, and \emph{Last Access Date} are also required. The relationship \emph{Following} has a foreign key constraint on \emph{Username} and \emph{Following Username} relating to the \emph{User} entity. 
\subsection{Sample instance data}
\subsubsection{Person Entity}
\emph{1, Milo, Berry} \\
\emph{2, Theo, Cat} \\
\emph{3, Ari, Wisenburn} \\
\emph{4, Gunnar, Bachmann} \\
\emph{5, Noah, Pelletier}

\subsubsection{Acts In Relationship}
Person \emph{Milo Berry} acts in Movie \emph{1917} \\
Person \emph{Ari Wisenburn} acts in Movie \emph{1917} \\
Person \emph{Gunnar Bachmann} acts in Movie \emph{Spider-Man: Far From Home} \\
Person \emph{Gunnar Bachmann} acts in Movie \emph{Uncharted} \\
Person \emph{Theo Cat} acts in Movie \emph{How to be a Cat}

\subsubsection{Directs Relationship}
Person \emph{Milo Berry} directs Movie \emph{The Cursed} \\
Person \emph{Ari Wisenburn} directs Movie \emph{Scream} \\
Person \emph{Noah Pelletier} directs Movie \emph{Studio 666} \\
Person \emph{Noah Pelletier} directs Movie \emph{Dog} \\
Person \emph{Theo Cat} directs Movie \emph{How to be a Cat: The Sequel}

\subsubsection{Movie Entity}
\emph{1, Uncharted, PG-13, 2/18/2022, 123 min, NULL} \\
\emph{2, 1917, R, 1/10/2020, 142 min, 4.84} \\
\emph{3, Spider-Man, PG-13, 4/1/2002, 94 min, 3.42}\\
\emph{4, Scream, R, 10/31/1993, 132 min, 4.56} \\
\emph{5, Make Happy, PG-13, 2/18/2016, 83 min, 4.10}

\subsubsection{Genre Entity}
\emph{1, Western} \\
\emph{2, Crime} \\
\emph{3, Dark} \\
\emph{4, Superhero} \\
\emph{5, Comedy}

\subsubsection{MovieGenre Relationship}
Genre \emph{Horror} classifies Movie \emph{Scream} \\
Genre \emph{Action} classifies Movie \emph{Uncharted} \\
Genre \emph{Comedy} classifies Movie \emph{Make Happy} \\
Genre \emph{War} classifies Movie \emph{1917} \\
Genre \emph{Superhero} classifies Movie \emph{Spider-Man} \\

\subsubsection{Studio Entity}
\emph{1, Fake Studio} \\
\emph{2, Another Fake Studio} \\
\emph{3, Studio 666} \\
\emph{4, Theo's Studio} \\
\emph{5, Final Studio}

\subsubsection{Funds Relationship}
Studio \emph{Fake Studio} funds Movie \emph{Uncharted} \\
Studio \emph{Another Fake Studio} funds Movie \emph{Uncharted} \\
Studio \emph{Fake Studio} funds Movie \emph{1917} \\
Studio \emph{Studio 123} funds Movie \emph{Dog} \\
Studio \emph{Theo's Studio} funds Movie \emph{Cat Food: The Movie}

\subsubsection{User Entity}
\emph{miloblueberry, Milo, Berry, 1/2/2019, 2/18/2022, fakepassword, txb9274@rit.edu} \\
\emph{theo-is-perfect, Theo, Cat, 1/23/2020, 2/10/2021, wetfoodisbest, cat@cat.com}\\
\emph{ari\_wiserthanyou, Ari, Wisenburn, 10/2/2017, 1/1/2022, heylookapassword, ari@rit.edu} \\
\emph{gunnarwasinuncharted, Gunnar, Bachmann, 10/21/2020, 2/18/2022, gunnarwasinuncharted, gunnar@rit.edu} \\
\emph{noah-in-the-boat, Noah, Pelletier, 7/2/2021, 2/1/2022, fakepassword, noah@rit.edu}

\subsubsection{Watches Relationship}
Person \emph{Milo Berry} watches Movie \emph{1917}: \emph{Rating}: 5, \emph{Date Watched}: 2/3/2019\\
Person \emph{Ari Wisenburn} watches Movie \emph{Scream}: \emph{Rating}: 3, \emph{Date Watched}: 2/13/2021 \\
Person \emph{Milo Berry} watches \emph{1917}: \emph{Rating}: 5, \emph{Date Watched}: 12/5/2020 \\
Person \emph{Gunnar Bachmann} watches \emph{Scream}: \emph{Rating}: 4, \emph{Date Watched}: 10/31/2022 \\
Person \emph{Gunnar Bachmann} watches \emph{Uncharted} : \emph{Rating}: 2, \emph{Date Watched}: 2/3/2022

\subsubsection{Follow Relationship}
User \emph{miloblueberry} follows User \emph{ari\_wiserthanyou} \\
User \emph{ari\_wiserthanyou} follows User \emph{noah-in-the-boat} \\
User \emph{noah-in-the-boat} follows User \emph{ari\_wiserthanyou} \\
User \emph{miloblueberry} follows User \emph{theo-is-perfect} \\
User \emph{theo-is-perfect} follows User \emph{cat-food-is-the-best}

\subsubsection{Collection Entity}
\emph{1, Horror Movies, 120 min, 2 movies} \\
\emph{2, Slasher Films, 5001 min, 12 movies} \\
\emph{3, Comedies, 290 min, 5 movies} \\
\emph{4, Stand-up, 67 min, 1 movie} \\
\emph{5, Empty Collection, 0 min, 0 movies}

\subsubsection{Creates Relationship}
User \emph{miloblueberry} creates Collection \emph{Horror Films} \\
User \emph{ari\_wiserthanyou} creates Collection \emph{Horror Films} \\
User \emph{noah-in-the-boat} creates Collection \emph{Funny Comedies} \\
User \emph{miloblueberry} creates Collection \emph{Unfunny Comedies} \\
User \emph{theo-is-perfect} creates Collection \emph{Movies about Cats}

\subsubsection{Comprises Relationship}
Movie \emph{Scream} comprises Collection \emph{Slasher Films} \\
Movie \emph{Make Happy} comprises Collection \emph{Funny Comedies} \\
Movie \emph{The Addams Family} comprises Collection \emph{Funny Comedies} \\
Movie \emph{Homeward Bound} comprises Collection \emph{Dog Movies} \\
Movie \emph{Scream} comprises Collection \emph{Horror Movies} 

\section{Implementation}
\begin{lstlisting}
create table p320_21.movie
(
    movie_id     int not null
        constraint movie_pk
            primary key,
    title        varchar,
    mpaa_rating  varchar,
    runtime      int,
    release_date date,
    director_id  int
        constraint movie_person_id_fk
            references p320_21.person
        constraint mpaa_rating check(mpaa_rating in ('G', 'PG', 'PG-13', 'R', 'NC-17', 'NR'))
);

create unique index movie_movie_id_uindex
    on p320_21.movie (movie_id);
\end{lstlisting}
\begin{lstlisting}
create table p320_21."user"
(
    username        varchar not null
        constraint user_pk
            primary key,
    name_id          int not null
        constraint user_name_id_fk
            references p320_21.name,
    creation_date    date not null,
    password         varchar not null,
    email            varchar not null,
    last_access_date date not null
);

create unique index user_username_uindex
    on p320_21."user" (username);
    
create table p320_21.name
(
    id         SERIAL
        constraint name_pk
            primary key,
    first_name varchar not null,
    last_name  varchar not null
);

create unique index name_id_uindex
    on p320_21.name (id);
\end{lstlisting}
For the 2 databases, \emph{Name} and \emph{Collection}, that would be added to in the application with unique ids with the \emph{serial} attribute allowing us to easily add to these tables without finding the previously added id and increment it to insert new data. 

To upload data to our tables, we first sanitized and processed the data set we selected as well as creating dummy data for values that did not exist within that dataset. We then downloaded this sanitized data into separate CSV files for each table. We then used DataGrip's built in import CSV file to table functionality. We started with the tables that had no foreign keys: \emph{Name}, \emph{Genre}, and \emph{Studio}. Then we moved to the two entities with foreign keys \emph{Person} and \emph{Movie}. Then, we populated the relationship tables \emph{ActsIn}, \emph{Funds}, and \emph{MovieGenre}. If we had used insert statements, they would be similar to:
\begin{lstlisting}
insert into p320_21.name(name_id, first_name, last_name) values (1, 'First', 'Last');
insert into p320_21.name(name_id, first_name, last_name) values (2, 'Second', 'Super Final');
insert into p320_21.genre(genre_id, name) values (1, 'Crime');
insert into p320_21.genre(genre_id, name) values (2, 'Horror');
insert into p320_21.studio(studio_id, name) values (1, 'Test Studio');
insert into p320_21.studio(studio_id, name) values (2, 'Test Studio 2');
insert into p320_21.person(person_id, name_id) values (1, 1);
insert into p320_21.person(person_id, name_id) values (2, 2);
insert into p320_21.movie(movie_id, title, mpaa_rating, runtime, release_date, director_id) values (1, '1917', 'R', 230, '2020-04-06', 1);
insert into p320_21.movie(movie_id, title, mpaa_rating, runtime, release_date, director_id) values (2, 'Spider-Man', 'PG-13', 183, '2021-12-17', 2);
insert into p320_21.acts_in(movie_id, person_id) values (1, 1);
insert into p320_21.acts_in(movie_id, person_id) values (2, 2);
insert into p320_21.funds(movie_id, studio_id) values (1, 1);
insert into p320_21.funds(movie_id, studio_id) values (2, 2);
insert into p320_21.movie_genre(movie_id, genre_id) values (1, 1);
insert into p320_21.movie_genre(movie_id, genre_id) values (2, 2);
\end{lstlisting}

For the tables that involve user interaction, \emph{User}; \emph{Collection}; \emph{Following}; \emph{MoviesInCollection}; and \emph{Watched}, we used the application insert statements to add data in these databases instead of bulk-loading all the data into the tables. These statements looked like:

\begin{lstlisting}
INSERT INTO p320_21.collection(name, username) VALUES ('test_name', 'test_username');
INSERT INTO p320_21.collection(name, username) VALUES ('new collection', 'test_username_2');
INSERT INTO p320_21.movies_in_collection(collection_id, movie_id) VALUES (1, 1);
INSERT INTO p320_21.movies_in_collection(collection_id, movie_id) VALUES (2, 2);
INSERT INTO p320_21."user" (username, name_id, creation_date, password, email, last_access_date) VALUES ('test_user', 1, '2022-03-18', 'password', 'test@test.com', '2022-03-18');
INSERT INTO p320_21."user" (username, name_id, creation_date, password, email, last_access_date) VALUES ('test_user_2', 2, '2022-03-19', 'password_2', 'test2@test2.com', '2022-03-19');
INSERT INTO p320_21.following (username, following_username) VALUES ('test_user', 'test_user_2');
INSERT INTO p320_21.following (username, following_username) VALUES ('test_user_2', 'test_user');
INSERT INTO p320_21.watched(username, movie_id, date_watched) VALUES ('test_user', 1, '2022-03-19');
INSERT INTO p320_21.watched(username, movie_id, date_watched) VALUES ('test_user_2', 2, '2022-03-20');
INSERT INTO p320_21.name(first_name, last_name) VALUES ('Milo', 'Berry') RETURNING id;
INSERT INTO p320_21.name(first_name, last_name) VALUES ('Gunnar', 'Bachman') RETURNING id;
\end{lstlisting}

% â€“ contains sample queries (2 for each table) for populating the data
Here are a list of example queries we made to populate data in our application:
\begin{lstlisting}
-- Name
SELECT first_name, last_name FROM p320_21.name WHERE id = 1;
SELECT name_id FROM p320_21.name WHERE first_name = 'Sample' and last_name = 'Name';
-- Studio
SELECT name FROM p320_21.studio WHERE id = 1;
SELECT studio_id, name FROM p320_21.studio WHERE name LIKE '%sample%';
-- Genre
SELECT name FROM p320_21.genre WHERE id = 1;
SELECT genre_id, name FROM p320_21.studio WHERE name LIKE '%sample%';
-- Person
SELECT name.first_name, name.last_name FROM p320_21.person LEFT JOIN p320_21.name on person.name_id = name.id WHERE person.person_id = 1;
SELECT person.id FROM p320_21.person LEFT JOIN p320_21.name on person.name_id = name.id WHERE name.first_name LIKE '%test%';
-- Movie
SELECT title, mpaa_rating, runtime / 60 AS hours, runtime % 60 AS minutes, release_date, date_watched, star_rating FROM p320_21.movie LEFT JOIN p320_21.watched ON movie.movie_id = watched.movie_id WHERE username = 'test_user' AND movie.movie_id = 1;
SELECT id FROM p320_21.movie WHERE title LIKE '%test%';
-- ActsIn
SELECT person)id FROM p320_21.acts_in WHERE movie_id = 1;
SELECT movie_id FROM p320_21.acts_in WHERE person_id = 1;
-- MovieGenre
SELECT movie_id FROM p320_21.movie_genre WHERE genre_id = 1;
SELECT genre.name FROM p320_21.movie_genre LEFT JOIN p320_21.genre ON movie_genre.genre_id = genre.genre_id WHERE movie_genre.movie_id = 1;
-- Funds
SELECT movie_id FROM p320_21.funds WHERE studio_id = 1;
SELECT studio.name FROM p320_21.funds LEFT JOIN p320_21.studio ON funds.studio_id = studio.studio_id WHERE funds.movie_id = 1;
-- User
SELECT * FROM p320_21."user" WHERE username = 'sample_user' LIMIT 1;
SELECT * FROM p320_21."user" WHERE username = 'sample_user' AND password = 'password' LIMIT 1;
-- Collection
SELECT collection_id FROM p320_21.collection WHERE name = 'collection' AND username = 'test_user';
SELECT collection_id FROM p320_21.collection WHERE username = 'test_user';
-- Following
SELECT following.following_username, name.first_name, name.last_name FROM p320_21.following LEFT JOIN p320_21."user" ON following.following_username = "user".username LEFT JOIN p320_21.name ON "user".name_id = name.id WHERE following.username = 'test_user';
SELECT following_username FROM p320_21.following WHERE username = 'test_user';
-- MoviesInCollection
SELECT movie_id FROM p320_21.movies_in_collection WHERE collection_id = 1;
SELECT movie.title FROM p320_21.movies_in_collection LEFT JOIN p320_21.movie ON movies_in_collection.movie_id = movie.movie_id WHERE movies_in_collection.collection_id = 1;
-- Watched
SELECT movie_id FROM p320_21.watched WHERE username = 'test_user';
SELECT rating FROM p320_21.watched WHERE username = 'test user' and movie_id = 1;
\end{lstlisting}
%Finally, add an appendix of all the SQL statements created in your application during Phase 4 and a description of the indexes created to boost the performance of your application.
\section{Data Analysis}
\subsection{Hypothesis}
Use this section to state the objectives of your data analysis; what are the observations you are expecting to find. Note that your final
observations may end up differing from your proposal, that is also a valid result.
\subsection{Data Preprocessing}
Use this section to describe the preprocessing steps you have performed to prepare the data for the analytics. Preprocessing steps may include: data cleaning (e.g., filling missing values, fixing outliers), formatting the data (e.g., resolving issues like inconsistent abbreviations, multiples date format in the data), combining or splitting fields, add new information (data enrichness).

Explain how the data was extracted from the database for the analysis; if you used complex queries or views, or both.
\subsection{Data Analytics \& Visualization}
Use this section to explain the process/techniques used to analyze the data, use data visualization to present the results, and explain them.
\subsection{Conclusions}
Use this section to explain the conclusions drawn from your data analysis.\\
\section{Lessons Learned}
Use this section to describe the issues you faced during the project and how you overcame them. Also, describe what you learned during this effort; this section, like the others, plays a critical component in determining your final grade.\\

{\bf The next subsection is meant to provide you with some help in
  dealing with figures, tables and references, as these are sometimes
  hard for folks new to \LaTeX. Your figures and tables
  may be distributed all over your paper (not just here), as appropriate for your paper.

  Please delete the following subsection before you make any submissions!}

\subsection{Tables, Figures, and Citations/References}

Tables, figures, and references in technical
documents need to be presented correctly. As many students
are not familiar with using these objects, here is a quick
guide extracted from the ACM style guide.

\begin{table}
\centering
\caption{Feelings about Issues}
\label{SAMPLE TABLE}
\begin{tabular}{|l|r|l|} \hline
Flavor&Percentage&Comments\\ \hline
Issue 1 &  10\% & Loved it a lot\\ \hline
Issue 2 &  20\% & Disliked it immensely\\ \hline
Issue 3 &  30\% & Didn't care one bit\\ \hline
Issue 4 &  40\% & Duh?\\ \hline
\end{tabular}
\end{table}


First, note that figures in the report must be original, that is,
created by the student: please do not cut-and-paste figures from any
other paper or report you have read or website. Second, if you do need to include figures,
they should be handled as demonstrated here. State that
Figure~\ref{SAMPLE FIGURE} is a simple illustration used in the ACM
Style sample document. Never refer to the figure below (or above)
because figures may be placed by \LaTeX{} at any appropriate location
that can change when you recompile your source $.tex$
file. Incidentally, in proper technical writing (for reasons beyond
the scope of this discussion), table captions are above the table and
figure captions are below the figure. So the truly junk information
about flavors is shown in Table~\ref{SAMPLE TABLE}.

\begin{figure}[htb]
\begin{center}
\includegraphics[width=1.5in]{images/fly.jpg}
\caption{A sample black \& white graphic (JPG).}
\label{SAMPLE FIGURE}
\end{center}
\end{figure}
\section{Resources}
The dataset we used to populate our \emph{Movie} data table was https://www.kaggle.com/kaushikmetha/imdb-movies?select=imdb\_cleaned.csv. All other data was randomly generated.
\end{document}
